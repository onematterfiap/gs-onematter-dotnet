@model IEnumerable<OneMatter.Models.ViewModels.AnonymousCandidateViewModel>

@{
    // Usa o ViewData que definimos no controlador
    ViewData["Title"] = "Candidatos: " + ViewData["VagaTitulo"];
}
<div class="page-container">

    <div class="page-header">
        <h2 class="page-title">
            <i class="fas fa-users me-2"></i>
            @ViewData["Title"]
        </h2>
        <div class="page-header-actions">
            <a asp-controller="Jobs" asp-action="Index" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Voltar para Vagas
            </a>
        </div>
    </div>

    <div class="alert alert-info shadow-sm">
        <h4 class="alert-heading"><i class="fas fa-user-secret me-2"></i>Triagem Anônima (Etapa 1)</h4>
        <p>Conforme os requisitos do OneMatter, dados como nome, género e foto estão ocultos. Analise cada candidato abaixo com base 100% no mérito e aprove-os para a Etapa 2 (Teste Prático) se cumprirem os requisitos.</p>
    </div>

    @if (!Model.Any())
    {
        <div class="card shadow-sm empty-state-card">
            <div class="card-body text-center">
                <i class="fas fa-user-clock fa-3x text-muted mb-3"></i>
                <h4 class="h5">Nenhum candidato ainda</h4>
                <p class="text-muted">Ainda não há candidatos inscritos para esta vaga.</p>
            </div>
        </div>
    }
    else
    {
        <div class="card shadow-sm table-card">
            <div class="card-body p-0">
                <table class="table table-hover m-0">
                    <thead class="table-light table-header-stylish">
                        <tr>
                            <th>@Html.DisplayNameFor(model => model.AnonymousId)</th>
                            <th>@Html.DisplayNameFor(model => model.Skills)</th>
                            <th>@Html.DisplayNameFor(model => model.SkillScore)</th>
                            <th>@Html.DisplayNameFor(model => model.Status)</th>
                            <th class="text-end">Ação</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td class="align-middle fw-bold">@Html.DisplayFor(modelItem => item.AnonymousId)</td>
                                <td class="align-middle">@Html.DisplayFor(modelItem => item.Skills)</td>
                                <td class="align-middle">
                                    <span class="badge bg-primary rounded-pill fs-small">@Html.DisplayFor(modelItem => item.SkillScore)</span>
                                </td>

                                <td class="align-middle">
                                    @{
                                        string statusText = item.Status.ToString();
                                        string badgeClass = "bg-secondary";
                                        switch (item.Status)
                                        {
                                            case OneMatter.Models.ApplicationStatus.Pendente:
                                                badgeClass = "bg-warning text-dark"; // Amarelo para Pendente
                                                statusText = "Pendente";
                                                break;

                                            default:
                                                badgeClass = "bg-success"; // Assumindo que o default é Aprovado/Concluído
                                                statusText = item.Status.ToString(); // Exibe o nome real do enum
                                                break;
                                        }
                                    }
                                    <span class="badge @badgeClass rounded-pill fs-small">@statusText</span>
                                </td>

                                <td class="text-end align-middle">
                                    @if (item.Status == OneMatter.Models.ApplicationStatus.Pendente)
                                    {
                                        <form asp-action="Approve" method="post" class="m-0">
                                            <input type="hidden" name="applicationId" value="@item.ApplicationId" />
                                            <button type-="submit" class="btn btn-sm btn-success">
                                                <i class="fas fa-check me-1"></i> Aprovar (Etapa 2)
                                            </button>
                                        </form>
                                    }
                                    else
                                    {
                                        <button class="btn btn-sm btn-outline-secondary disabled" disabled>
                                            Ação Concluída
                                        </button>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>